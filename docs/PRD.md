# ArtWall 产品需求文档（PRD）

## 一、产品概述

### 1.1 产品名称
ArtWall（艺墙）

### 1.2 一句话描述
基于用户审美偏好，智能推荐艺术画作，并提供实体画作交付服务。

### 1.3 核心价值
> **"根据用户审美偏好，推荐真正适合他的画作，并交付实体画作到家"**

解决用户痛点：
- 画太多不知道选什么 → 基于你的行为持续优化推荐
- 不懂艺术怕选错 → 越看越准，推荐会自动匹配你的审美
- 选完还要自己找地方买 → 一站式交付实体画作

### 1.4 目标用户
- 新房装修完需要挂画的人
- 想更换家中装饰画的人
- 对艺术画感兴趣但不知如何选择的人

---

## 二、MVP 核心流程

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   选择家居风格 ──▶ 无限画作流 ──▶ 收藏/隐藏/购买                  │
│        ↓              ↓                                        │
│   初始化偏好向量    持续追踪用户行为                               │
│                         ↓                                       │
│                   实时更新推荐                                   │
│                   推荐越来越精准                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**核心理念：**
- 无需测试或测验，直接开始浏览
- 像 TikTok/探探一样，用户的每个行为都在优化推荐
- 没有"最终结果页"，只有持续改进的无限流

---

## 三、用户输入（Input）

### 3.1 家居偏好风格（必填，用于初始化）

用户从预设的风格图片中选择自己喜欢的 1-2 种风格。

**作用：** 创建用户的初始偏好向量（embedding）

**风格选项（共8种）：**

| 编号 | 风格名称 | 代码 | 关键词 |
|-----|---------|------|--------|
| 1 | 现代简约 | modern | 黑白灰、线条感、少即是多 |
| 2 | 北欧 | nordic | 白色、木质、绿植、温暖 |
| 3 | 日式/侘寂 | japanese | 原木、低饱和、自然、禅意 |
| 4 | 新中式 | chinese | 木质、对称、留白、东方元素 |
| 5 | 法式/轻奢 | french | 石膏线、金色点缀、优雅 |
| 6 | 美式 | american | 深色木质、复古、厚重 |
| 7 | 工业风 | industrial | 水泥、金属、裸露管道 |
| 8 | 奶油风/混搭 | cream | 柔和色调、舒适、无明显风格 |

### 3.2 用户行为（持续追踪）

用户在浏览过程中的所有行为都会被追踪，用于持续优化推荐。

| 行为 | 信号权重 | 说明 |
|-----|---------|------|
| 购买 | +1.0 | 最强正向信号 |
| 收藏 | +0.5 | 强烈喜欢 |
| 分享 | +0.4 | 喜欢 |
| 点击详情 | +0.2 | 表示兴趣 |
| 长时间停留 (>5s) | +0.3 | 强烈兴趣 |
| 中等停留 (3-5s) | +0.2 | 中等兴趣 |
| 短暂停留 (1-3s) | +0.1 | 轻微兴趣 |
| 曝光 | 0 | 仅记录 |
| 隐藏/"不喜欢" | -0.5 | 强烈不喜欢 |
| 取消收藏 | -0.3 | 改变心意 |

### 3.3 房间照片（可选，V2）

| 字段 | 说明 |
|-----|------|
| 数量 | 1-3张 |
| 要求 | 正面拍摄要挂画的墙面，光线清晰 |
| 格式 | JPG/PNG，最大 10MB |

**用途：**
1. 生成房间的 embedding，混合到用户偏好中
2. 效果渲染：将推荐的画作合成到照片中预览效果

---

## 四、系统处理

### 4.1 推荐算法核心逻辑

#### Embedding-based 推荐

使用 CLIP (ViT-B/32) 模型生成 512 维向量：
- 每幅画作有预计算的 embedding
- 每个家居风格有预计算的 embedding
- 每个用户有动态更新的 embedding

```
用户选择风格 → 初始化用户 embedding
    ↓
用户浏览画作 → 追踪所有行为
    ↓
根据行为信号 → 持续更新用户 embedding
    ↓
向量相似度搜索 → 返回最匹配的画作
```

#### Embedding 更新算法

```python
def update_embedding(user_embedding, painting_embedding, signal_weight):
    """
    positive weight → move toward painting (like)
    negative weight → move away from painting (dislike)
    """
    direction = painting_embedding - user_embedding
    new_embedding = user_embedding + learning_rate * signal_weight * direction
    return normalize(new_embedding)  # 归一化到单位向量
```

#### 推荐查询

```sql
SELECT id, title, artist, image_url,
       1 - (embedding <=> user_embedding) AS similarity
FROM paintings
WHERE id NOT IN (已展示过的画作)
ORDER BY similarity DESC
LIMIT 10;
```

### 4.2 事件驱动架构

```
用户行为 → POST /api/activity → Pub/Sub → Event Worker → 更新 Embedding
                ↓
           立即返回 (不阻塞用户)
```

**设计原则：**
- Log everything: 记录所有用户行为
- Process async: 异步处理，不阻塞用户
- Never block: 接口立即返回

---

## 五、用户输出（Output）

### 5.1 无限画作流

每幅画包含：

| 字段 | 说明 |
|-----|------|
| 画作名称 | 如《星月夜》 |
| 作者 | 如 文森特·梵高 |
| 年代 | 如 1889 |
| 流派 | 如 后印象派 |
| 缩略图 | 画作预览图 |
| 相似度 | 0-1，展示与用户偏好的匹配程度 |

### 5.2 收藏列表

用户收藏的画作，可随时查看和管理。

### 5.3 效果渲染图（V2）

| 内容 | 说明 |
|-----|------|
| 渲染效果图 | 画挂在用户墙上的合成效果 |
| 支持切换 | 可切换不同候选画查看效果 |
| 可下载 | 用户可保存效果图 |

---

## 六、数据需求

### 6.1 画库数据

**数据来源（公共版权）：**

| 来源 | 网址 | 说明 |
|-----|------|------|
| WikiArt | wikiart.org | 大量西方艺术作品 |
| 大都会博物馆 | metmuseum.org | Open Access 藏品 |
| 芝加哥艺术博物馆 | artic.edu | CC0 公共领域作品 |
| 国家美术馆(US) | nga.gov | 公共领域藏品 |
| 史密森尼 | si.edu | Open Access |

**数据字段：**

| 字段 | 类型 | 说明 |
|-----|------|------|
| id | string | 唯一标识 |
| title | string | 画作名称 |
| title_en | string | 英文名称 |
| artist | string | 作者 |
| artist_en | string | 作者英文名 |
| year | number | 创作年代 |
| style | string | 流派 |
| image_url | string | 缩略图链接 |
| image_hd_url | string | 高清图链接 |
| source | string | 来源 |
| source_url | string | 原始页面链接 |
| license | string | 版权信息 |
| **embedding** | vector(512) | CLIP 生成的向量 |
| tags | string[] | 可选标签 |
| aspect_ratio | string | 横幅/竖幅/方形 |

**MVP 画库规模建议：**
- 初期：500-1000 幅精选画作
- 覆盖主要流派和风格
- 确保每种家居风格都有足够匹配选项

### 6.2 家居风格配置

**存储方式：** 静态配置（代码中预计算）

每种风格需要：
- 1-2 张代表性图片（用于用户选择界面）
- 预计算的 CLIP embedding（512 维向量）

### 6.3 用户数据

| 表 | 说明 |
|---|------|
| user_preferences | 用户偏好向量、交互次数 |
| activities | 所有用户行为日志 |
| shown_paintings | 已展示过的画作（避免重复） |
| saved_paintings | 收藏的画作 |

---

## 七、后续迭代方向（V2+）

| 功能 | 说明 |
|-----|------|
| 效果渲染 | 将画作合成到用户房间照片中 |
| 风水模块 | 根据方位、房间类型给出风水建议 |
| 画框推荐 | 推荐适合的画框款式、颜色、材质 |
| 材质推荐 | 普通打印/油画布/肌理画推荐 |
| 尺寸计算 | 根据墙面大小推荐最佳尺寸 |
| 淘宝对接 | 一键跳转淘宝店铺下单 |
| 用户账号 | 保存历史推荐、收藏画作 |
| AI 生成画作 | 根据用户偏好 AI 生成独特画作 |

---

## 八、技术架构概览

```
┌──────────────────────────────────────────────────────────────────────────┐
│                                  GCP                                      │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                          Cloud Run                                   │ │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  │ │
│  │  │   Next.js App   │    │  Python CLIP    │    │  Event Worker   │  │ │
│  │  │                 │    │  Service        │    │  (Python)       │  │ │
│  │  │  - Frontend     │    │                 │    │                 │  │ │
│  │  │  - API Routes   │    │  /api/embedding │    │  Process Pub/Sub│  │ │
│  │  └────────┬────────┘    └─────────────────┘    └────────┬────────┘  │ │
│  └───────────┼─────────────────────────────────────────────┼───────────┘ │
│              │                                             │             │
│              ▼                                             │             │
│  ┌─────────────────────┐                                   │             │
│  │   Cloud Pub/Sub     │◀──────────────────────────────────┘             │
│  │  Topic: activities  │                                                 │
│  └─────────────────────┘                                                 │
│              │                                                           │
│              ▼                                                           │
│  ┌─────────────────┐         ┌─────────────────┐                        │
│  │   Cloud SQL     │         │ Cloud Storage   │                        │
│  │   (PostgreSQL   │         │    (Bucket)     │                        │
│  │   + pgvector)   │         │  - paintings/   │                        │
│  └─────────────────┘         └─────────────────┘                        │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

| 服务 | 技术 | 说明 |
|-----|------|------|
| 前端 + API | Next.js 14 | 页面 + API Routes |
| ML 服务 | Python FastAPI | CLIP embedding 生成 |
| 消息队列 | Cloud Pub/Sub | 活动事件异步处理 |
| 数据库 | PostgreSQL + pgvector | 关系型 + 向量搜索 |
| 图片存储 | Cloud Storage | 画作图片 |

---

## 九、待办事项

### 基础设施
- [ ] 创建 GCP 项目
- [ ] 配置 Cloud SQL (PostgreSQL + pgvector)
- [ ] 创建 Cloud Storage bucket
- [ ] 配置 Pub/Sub topic 和 subscription
- [ ] 部署 Cloud Run 服务

### 数据准备
- [ ] 爬取 WikiArt 画作数据
- [ ] 爬取大都会博物馆 Open Access 数据
- [ ] 批量生成画作 embeddings
- [ ] 预计算家居风格 embeddings
- [ ] 准备家居风格选择界面图片

### 后端开发
- [ ] Python CLIP embedding 服务
- [ ] Event Worker 服务
- [ ] Next.js API Routes

### 前端开发
- [ ] Landing Page
- [ ] 风格选择页 (Onboarding)
- [ ] 无限画作流 (Feed)
- [ ] 画作详情页
- [ ] 收藏列表

---

*文档版本：v2.0*
*更新日期：2025-12-30*
*关键变更：
- 移除 5 轮偏好测试，改为持续追踪用户行为
- 移除"最终结果页"，改为无限流
- 算法从手工打分改为 CLIP embedding + 向量相似度
- 架构更新为 GCP + 事件驱动*

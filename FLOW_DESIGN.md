# ArtWall 产品流程设计

## 一、整体用户流程

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  Landing Page ──▶ 上传照片 ──▶ 选择家居风格 ──▶ 画作偏好测试    │
│                                                                 │
│        ──▶ 画作推荐列表 ──▶ 效果预览 ──▶ 下单                   │
│             (规则匹配)                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**MVP vs V2 区别：**
- MVP: 偏好测试完成后，通过规则匹配直接返回画作列表
- V2: 增加 AI 分析模块，生成"审美画像"报告，推荐更精准

---

## 二、页面结构与流程详解

### Page 1: Landing Page（首页）

**目的：** 介绍产品价值，引导用户开始

**页面元素：**
```
┌──────────────────────────────────────────┐
│  Logo: ArtWall                           │
├──────────────────────────────────────────┤
│                                          │
│  主标题: 找到真正适合你的画               │
│  副标题: AI分析你的审美偏好               │
│          从世界名画中为你精选              │
│                                          │
│  ┌────────────────────────────────────┐  │
│  │                                    │  │
│  │    Hero Image                      │  │
│  │    (展示效果图：画挂在家中的样子)    │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                          │
│         [ 开始选画 → ]  (CTA按钮)         │
│                                          │
├──────────────────────────────────────────┤
│  三步流程说明:                            │
│  ① 上传房间照片                          │
│  ② 完成审美测试                          │
│  ③ 获得专属推荐                          │
├──────────────────────────────────────────┤
│  Footer: 关于我们 | 联系方式              │
└──────────────────────────────────────────┘
```

**交互：**
- 点击「开始选画」→ 进入 Page 2

---

### Page 2: 上传房间照片

**目的：** 收集用户房间信息，用于效果渲染

**页面元素：**
```
┌──────────────────────────────────────────┐
│  进度条: [■■□□□] Step 1/4               │
├──────────────────────────────────────────┤
│                                          │
│  标题: 上传你想挂画的墙面照片              │
│  说明: 正面拍摄，光线清晰效果更好          │
│                                          │
│  ┌────────────────────────────────────┐  │
│  │                                    │  │
│  │   📷 点击上传 或 拖拽图片到这里      │  │
│  │                                    │  │
│  │   支持 JPG/PNG，最大 10MB           │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                          │
│  (上传后显示预览图，可重新上传)            │
│                                          │
│  [ 跳过此步 ]       [ 下一步 → ]          │
│                                          │
└──────────────────────────────────────────┘
```

**交互：**
- 上传图片 → 显示预览
- 点击「下一步」→ 进入 Page 3
- 点击「跳过此步」→ 进入 Page 3（无效果渲染功能）

**数据：**
- 输出: `room_image: File | null`

---

### Page 3: 选择家居风格

**目的：** 确定用户家居风格，用于画作匹配

**页面元素：**
```
┌──────────────────────────────────────────┐
│  进度条: [■■■□□] Step 2/4               │
├──────────────────────────────────────────┤
│                                          │
│  标题: 选择最接近你家的风格                │
│  说明: 可选择 1-2 个                      │
│                                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │         │ │         │ │         │    │
│  │ 现代简约 │ │  北欧   │ │ 日式侘寂 │    │
│  │         │ │         │ │         │    │
│  └─────────┘ └─────────┘ └─────────┘    │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │         │ │         │ │         │    │
│  │  新中式  │ │ 法式轻奢 │ │  美式   │    │
│  │         │ │         │ │         │    │
│  └─────────┘ └─────────┘ └─────────┘    │
│  ┌─────────┐ ┌─────────┐                │
│  │         │ │         │                │
│  │  工业风  │ │ 奶油/混搭│                │
│  │         │ │         │                │
│  └─────────┘ └─────────┘                │
│                                          │
│       [ ← 上一步 ]    [ 下一步 → ]        │
│                                          │
└──────────────────────────────────────────┘
```

**交互：**
- 点击风格卡片 → 选中（高亮边框）
- 可选 1-2 个，至少选 1 个才能继续
- 点击「下一步」→ 进入 Page 4

**数据：**
- 输出: `home_styles: string[]` (如 `["modern", "nordic"]`)

---

### Page 4: 画作偏好测试

**目的：** 通过二选一测试，判断用户审美偏好

**页面元素：**
```
┌──────────────────────────────────────────┐
│  进度条: [■■■■□] Step 3/4               │
├──────────────────────────────────────────┤
│                                          │
│  标题: 选择你更喜欢的一幅                  │
│  说明: 第 1/5 轮 - 跟着直觉走就好         │
│                                          │
│  ┌───────────────┐  ┌───────────────┐   │
│  │               │  │               │   │
│  │               │  │               │   │
│  │    画作 A     │  │    画作 B     │   │
│  │               │  │               │   │
│  │               │  │               │   │
│  │  [ 选这幅 ]   │  │  [ 选这幅 ]   │   │
│  └───────────────┘  └───────────────┘   │
│                                          │
│  ○ ○ ○ ○ ○  (5轮进度指示)                │
│                                          │
└──────────────────────────────────────────┘
```

**交互：**
- 点击任意一幅画 → 记录选择 → 自动进入下一轮
- 共 5 轮，完成后自动进入 Page 5

**5轮测试设计：**

| 轮次 | 维度 | 画作A | 画作B |
|-----|------|-------|-------|
| 1 | 具象 vs 抽象 | 莫奈《睡莲》 | 康定斯基《构成第八号》 |
| 2 | 暖色 vs 冷色 | 梵高《向日葵》 | 莫奈《睡莲池》 |
| 3 | 繁复 vs 极简 | 克里姆特《吻》 | 蒙德里安《红黄蓝构成》 |
| 4 | 东方 vs 西方 | 齐白石《虾》 | 维米尔《戴珍珠耳环的少女》 |
| 5 | 风景 vs 人物 | 弗里德里希《雾海上的旅人》 | 梵高《自画像》 |

**数据：**
- 输出: `preferences: {round: number, choice: 'A' | 'B'}[]`

---

### Page 5: 推荐结果页

**目的：** 展示推荐画作列表

**页面元素：**
```
┌──────────────────────────────────────────┐
│  进度条: [■■■■■] 完成                    │
├──────────────────────────────────────────┤
│                                          │
│  标题: 为你推荐的画作                      │
│  副标题: 根据你的偏好，从500+名画中精选    │
│                                          │
│  筛选标签: [全部] [风景] [抽象] [人物]... │
│                                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │         │ │         │ │         │    │
│  │  画作1   │ │  画作2   │ │  画作3   │    │
│  │         │ │         │ │         │    │
│  │ 《星月夜》│ │ 《睡莲》 │ │ 《构成》 │    │
│  │  梵高    │ │  莫奈   │ │ 蒙德里安 │    │
│  └─────────┘ └─────────┘ └─────────┘    │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │         │ │         │ │         │    │
│  │  画作4   │ │  画作5   │ │  画作6   │    │
│  │         │ │         │ │         │    │
│  └─────────┘ └─────────┘ └─────────┘    │
│                                          │
│  ... (更多画作，支持滚动加载)              │
│                                          │
│        [ 重新测试 ]  [ 加载更多 ]          │
│                                          │
└──────────────────────────────────────────┘
```

**交互：**
- 点击画作卡片 → 弹出 Modal 显示详情
- 点击筛选标签 → 过滤画作列表
- 点击「重新测试」→ 返回 Page 2
- 滚动到底部 → 自动加载更多

**匹配逻辑（规则匹配，非AI）：**
1. 根据家居风格筛选 `suitable_styles` 匹配的画
2. 根据偏好测试结果筛选：
   - 第1轮选A → 偏具象，选B → 偏抽象
   - 第2轮选A → 偏暖色，选B → 偏冷色
   - 第3轮选A → 偏繁复，选B → 偏极简
   - 第4轮选A → 偏东方，选B → 偏西方
   - 第5轮选A → 偏风景，选B → 偏人物
3. 综合打分排序，返回 Top N

---

### Page 5.1: 画作详情 Modal

**目的：** 展示画作详情，预览效果，引导下单

**页面元素：**
```
┌──────────────────────────────────────────┐
│                                    [X]   │
├──────────────────────────────────────────┤
│                                          │
│  ┌─────────────────┐  画作名: 《星月夜》  │
│  │                 │  作者: 文森特·梵高   │
│  │                 │  年代: 1889         │
│  │    画作大图      │  流派: 后印象派      │
│  │                 │                     │
│  │                 │  推荐理由:           │
│  │                 │  这幅画的蓝色调与    │
│  └─────────────────┘  你偏好的冷色系相符...│
│                                          │
│  ─────────────────────────────────────── │
│                                          │
│  效果预览:                                │
│  ┌────────────────────────────────────┐  │
│  │                                    │  │
│  │   (画作渲染到用户房间照片中)         │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                          │
│  尺寸选择: [40x50] [50x60] [60x80]       │
│                                          │
│        [ 加入心愿单 ]  [ 立即购买 → ]     │
│                                          │
└──────────────────────────────────────────┘
```

**交互：**
- 切换尺寸 → 更新效果预览
- 点击「立即购买」→ 进入 Page 7（或跳转外部淘宝链接）
- 点击「加入心愿单」→ 保存到本地/账户

---

### Page 7: 订单确认页（可选，MVP可跳转淘宝）

**目的：** 确认订单信息，完成购买

**页面元素：**
```
┌──────────────────────────────────────────┐
│  订单确认                                 │
├──────────────────────────────────────────┤
│                                          │
│  商品: 《星月夜》 - 梵高                   │
│  规格: 油画布打印 60x80cm 黑色细框        │
│                                          │
│  ┌─────┐                                 │
│  │ 预览 │  价格: ¥299                     │
│  └─────┘                                 │
│                                          │
│  收货信息:                                │
│  姓名: [____________]                    │
│  电话: [____________]                    │
│  地址: [____________]                    │
│                                          │
│           [ 提交订单 ]                    │
│                                          │
└──────────────────────────────────────────┘
```

---

## 三、数据流设计

```
┌─────────────┐
│   用户输入   │
└──────┬──────┘
       │
       ▼
┌──────────────────────────────────────────────────────┐
│  Session Data (前端状态)                              │
│                                                      │
│  {                                                   │
│    room_image: File | null,                          │
│    room_image_url: string | null,                    │
│    home_styles: ["modern", "nordic"],                │
│    preferences: [                                    │
│      {round: 1, choice: "A"},                        │
│      {round: 2, choice: "B"},                        │
│      ...                                             │
│    ]                                                 │
│  }                                                   │
└──────────────────────────────────────────────────────┘
       │
       │ 完成偏好测试后，请求推荐
       ▼
┌──────────────────────────────────────────────────────┐
│  POST /api/recommend                                 │
│                                                      │
│  Request:                                            │
│  {                                                   │
│    home_styles: string[],                            │
│    preferences: {round: number, choice: string}[],   │
│    page: 1,                                          │
│    limit: 20                                         │
│  }                                                   │
│                                                      │
│  Response:                                           │
│  {                                                   │
│    total: 150,                                       │
│    paintings: [                                      │
│      {                                               │
│        id: "001",                                    │
│        title: "星月夜",                              │
│        artist: "梵高",                               │
│        year: 1889,                                   │
│        style: "后印象派",                            │
│        image_url: "...",                             │
│        tags: ["cold", "landscape", ...]              │
│      },                                              │
│      ...                                             │
│    ]                                                 │
│  }                                                   │
└──────────────────────────────────────────────────────┘
       │
       │ 用户选择某幅画后，请求渲染效果图
       ▼
┌──────────────────────────────────────────────────────┐
│  POST /api/render                                    │
│                                                      │
│  Request:                                            │
│  {                                                   │
│    room_image_url: string,                           │
│    painting_image_url: string,                       │
│    size: "60x80"                                     │
│  }                                                   │
│                                                      │
│  Response:                                           │
│  {                                                   │
│    rendered_image_url: string                        │
│  }                                                   │
└──────────────────────────────────────────────────────┘
```

---

## 四、API 接口设计

### 4.1 上传图片

```
POST /api/upload

Request:
- Content-Type: multipart/form-data
- Body: { image: File }

Response:
{
  "image_url": "https://storage.artwall.com/xxx.jpg"
}
```

### 4.2 获取推荐画作

```
POST /api/recommend

Request:
{
  "home_styles": ["modern", "nordic"],
  "preferences": [
    {"round": 1, "choice": "A"},
    {"round": 2, "choice": "B"},
    {"round": 3, "choice": "A"},
    {"round": 4, "choice": "B"},
    {"round": 5, "choice": "A"}
  ],
  "page": 1,
  "limit": 20
}

Response:
{
  "total": 150,
  "paintings": [
    {
      "id": "p001",
      "title": "星月夜",
      "title_en": "The Starry Night",
      "artist": "文森特·梵高",
      "artist_en": "Vincent van Gogh",
      "year": 1889,
      "style": "后印象派",
      "image_url": "https://...",
      "image_hd_url": "https://...",
      "tags": ["cold", "landscape", "western", "expressive"],
      "available_sizes": ["40x50", "50x60", "60x80"]
    },
    // ... more paintings
  ]
}

匹配逻辑：
1. 筛选 suitable_styles 包含用户选择的家居风格
2. 根据偏好计算匹配分数
3. 按分数排序返回
```

### 4.3 渲染效果图

```
POST /api/render

Request:
{
  "room_image_url": "https://...",
  "painting_image_url": "https://...",
  "size": "60x80"
}

Response:
{
  "rendered_image_url": "https://storage.artwall.com/rendered/xxx.jpg"
}
```

### 4.4 获取画作列表（可选，用于浏览更多）

```
GET /api/paintings?style=modern&color=cold&page=1&limit=20

Response:
{
  "total": 150,
  "paintings": [...]
}
```

---

## 五、技术实现要点

### 5.1 前端

- **框架**: Next.js / React
- **状态管理**: 用 Context 或 Zustand 管理用户选择流程
- **图片上传**: 使用 presigned URL 直传 S3/OSS
- **响应式**: 适配移动端和桌面端

### 5.2 后端

- **框架**: Node.js (Express/Fastify) 或 Python (FastAPI)
- **AI 分析**: 调用 Claude/GPT API 生成分析报告
- **画库存储**: PostgreSQL + 向量数据库(可选，用于相似度检索)
- **图片存储**: AWS S3 / 阿里云 OSS
- **效果渲染**: 可用 Python + OpenCV 或调用图像生成 API

### 5.3 匹配算法设计

```
// 偏好测试结果转换为标签权重
function preferenceToWeights(preferences) {
  return {
    abstract: preferences[0].choice === 'B' ? 1 : 0,    // 第1轮
    concrete: preferences[0].choice === 'A' ? 1 : 0,
    cold: preferences[1].choice === 'B' ? 1 : 0,        // 第2轮
    warm: preferences[1].choice === 'A' ? 1 : 0,
    minimal: preferences[2].choice === 'B' ? 1 : 0,     // 第3轮
    complex: preferences[2].choice === 'A' ? 1 : 0,
    eastern: preferences[3].choice === 'A' ? 1 : 0,     // 第4轮
    western: preferences[3].choice === 'B' ? 1 : 0,
    landscape: preferences[4].choice === 'A' ? 1 : 0,   // 第5轮
    portrait: preferences[4].choice === 'B' ? 1 : 0,
  }
}

// 计算画作匹配分数
function calculateScore(painting, userWeights, homeStyles) {
  let score = 0

  // 风格匹配 (权重 40%)
  if (painting.suitable_styles.some(s => homeStyles.includes(s))) {
    score += 40
  }

  // 偏好匹配 (权重 60%)
  painting.tags.forEach(tag => {
    if (userWeights[tag]) score += 12
  })

  return score
}
```

---

## 六、MVP 范围

### 包含:
- [x] Landing Page
- [x] 上传照片
- [x] 选择家居风格
- [x] 5轮偏好测试
- [x] 规则匹配推荐画作
- [x] 画作推荐列表（支持分页/筛选）
- [x] 画作详情展示
- [x] 效果渲染预览

### 不包含 (V2):
- [ ] AI 审美分析报告
- [ ] 用户注册/登录
- [ ] 心愿单/收藏
- [ ] 在线支付
- [ ] 订单管理
- [ ] 风水模块
- [ ] 画框/材质推荐

---

## 七、页面路由

| 路由 | 页面 |
|-----|------|
| `/` | Landing Page |
| `/upload` | 上传照片 |
| `/style` | 选择家居风格 |
| `/preference` | 偏好测试 |
| `/result` | 推荐结果 |
| `/painting/:id` | 画作详情(可用Modal代替) |

---

*文档版本: v1.0*
*创建日期: 2025-12-30*
